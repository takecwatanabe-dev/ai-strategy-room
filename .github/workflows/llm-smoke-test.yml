name: LLM Smoke Test (Simple)

on:
  workflow_dispatch:

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: OpenAI auth check (list models)
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          set -e
          code=$(curl -sS -o openai_models.json -w "%{http_code}" \
            https://api.openai.com/v1/models \
            -H "Authorization: Bearer $OPENAI_API_KEY")
          echo "OpenAI HTTP $code"
          if [ "$code" != "200" ]; then
            echo "OpenAI failed. See openai_models.json"
            exit 1
          fi
          echo "✅ OpenAI OK"

      - name: Gemini auth check (list models)
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          set -e
          code=$(curl -sS -o gemini_models.json -w "%{http_code}" \
            "https://generativelanguage.googleapis.com/v1beta/models?key=$GEMINI_API_KEY")
          echo "Gemini HTTP $code"
          if [ "$code" != "200" ]; then
            echo "Gemini failed. See gemini_models.json"
            exit 1
          fi
          echo "✅ Gemini OK"

      - name: Upload raw JSON (artifact)
        uses: actions/upload-artifact@v4
        with:
          name: llm-smoke-test-json
          path: |
            openai_models.json
            gemini_models.json
